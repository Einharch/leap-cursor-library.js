/*! leap-cursor-library 2013-07-15 */
var LeapElement=function(a){return{element:a,cursor:null,isLeapElement:!0,isAttractor:function(){return"true"===this.element.getAttribute("leap-attractor")||null!=this.element.getAttribute("leap-attractor-x-padding")&&!isNaN(this.element.getAttribute("leap-attractor-x-padding"))||null!=this.element.getAttribute("leap-attractor-y-padding")&&!isNaN(this.element.getAttribute("leap-attractor-y-padding"))},appendChild:function(a){return a instanceof HTMLElement?this.element.appendChild(a):this.element.appendChild(a.getElement())},removeChild:function(a){return a instanceof HTMLElement?this.element.removeChild(a):this.element.removeChild(a.getElement())},setStyle:function(a){for(var b in a)this.element.style[b]=a[b]},getWidth:function(){return this.element.offsetWidth},getHeight:function(){return this.element.offsetHeight},getElement:function(){return a},hasCursor:function(){return null!==this.cursor},capture:function(a){this.cursor=a,this.cursor.capture(this)},release:function(){this.cursor&&(this.cursor.release(),this.cursor=null)},getAttractorPadding:function(){return{x:parseInt(this.element.getAttribute("leap-attractor-x-padding"),10)||0,y:parseInt(this.element.getAttribute("leap-attractor-y-padding"),10)||0}},getClickDelay:function(){return this.element.getAttribute("leap-click-delay")},hasMultitap:function(){return"true"===this.element.getAttribute("leap-enable-multitap")},isTappable:function(){return"true"!==this.element.getAttribute("leap-disable-tap")},isHoverable:function(){return"true"!==this.element.getAttribute("leap-disable-hover")},setXY:function(a,b){this.setX(a),this.setY(b)},setX:function(a){this.element.style.left=a+"px"},setY:function(a){this.element.style.top=a+"px"},getX:function(){return a.getBoundingClientRect().left},getY:function(){return a.getBoundingClientRect().top},addClass:function(a){var b=this.element.className;b&&-1!==b.indexOf(a)||(""!==b&&(a=" "+a),this.element.className=b+a)},removeClass:function(a){var b=this.element.className,c=new RegExp("\\s?\\b"+a+"\\b","g");b=b.replace(c,""),this.element.className=b},fireEvent:function(a){this.element.dispatchEvent(a)}}},LeapManagerUtils=function(){var a={},b="leap_element_",c=0;return{getLeapElement:function(d){return d.id||(d.id=b+c++),a[d.id]||(a[d.id]=new LeapElement(d)),a[d.id]},isElementVisible:function(a){for(;a!==document.body.parentNode;){if("0"===LeapManagerUtils.getStyle(a,"opacity")||"none"===LeapManagerUtils.getStyle(a,"display")||"hidden"===LeapManagerUtils.getStyle(a,"visibility"))return!1;a=a.parentNode}return!0},getStyle:function(a,b){return window.getComputedStyle?document.defaultView.getComputedStyle(a)[b]:a.currentStyle?a.currentStyle[b]:void 0},extend:function(a,b){for(var c in b)a[c]=b[c]},extendIf:function(a,b){for(var c in b)b[c]instanceof Object&&b[c].constructor===Object?((void 0===a[c]||null===a[c])&&(a[c]={}),LeapManagerUtils.extendIf(a[c],b[c])):(void 0===a[c]||null===a[c])&&(a[c]=b[c])},bind:function(a,b,c){return function(){c||(c=[]),c=Array.prototype.slice.call(arguments).concat(c),a.apply(b,c)}},map:function(a,b,c,d,e){return a===b?d:(a-b)*(e-d)/(c-b)+d},error:function(a){console.log(a)}}}(),Cursor=function(a){var b="leap-timer-cursor",c={x:0,y:0,z:0,X:0,Y:0,Z:0,vX:0,vY:0,vZ:0,enabled:!0,captureHost:null,attractor:null,element:null,isTimerRunning:!1,startTime:null,animiationIntervalID:null,currentClickDelay:0,defaultConfig:{multitapEnabled:!1,clickDelay:0,easing:.3},onAdded:function(){},onRemoved:function(){},constructor:function(a){if(!a.source)return LeapManagerUtils.error("Cursor#constructor: You must specify a `source`."),null;if(!a.id)return LeapManagerUtils.error("Cursor#constructor: You must specify a `id`."),null;if(!a.icon)return LeapManagerUtils.error("Cursor#constructor: You must specify a `icon`."),null;if(LeapManagerUtils.extendIf(a,this.defaultConfig),this.source=a.source,this.id=a.id,this.icon=a.icon,this.easing=a.easing,this.clickDelay=a.clickDelay,this.multitapEnabled=a.multitapEnabled,(0===this.clickDelay||isNaN(this.clickDelay))&&(this.clickDelay=null),this.onTapUpdate=LeapManagerUtils.bind(this._onTapUpdate,this),this.clickDelay&&this.icon.addClass(b),this.icon instanceof HTMLElement&&(this.icon=new LeapElement(this.icon)),a.position){this.update(a.position.x,a.position.y);var c=this.icon.getWidth()/2,d=this.icon.getHeight()/2;this.icon.setX(a.position.x*window.innerWidth+c),this.icon.setY(a.position.y*window.innerHeight+d)}},setEnabled:function(a){this.enabled=a},isEnabled:function(){return this.enabled},setElement:function(a){this.element=a},hasElement:function(){return null!==this.element},onElementOver:function(a){this.setElement(a),this.currentClickDelay=this.element.getClickDelay()||this.clickDelay,a.isHoverable()&&a.addClass("hover"),this.currentClickDelay&&a.isTappable()&&this.startTimer()},onElementMove:function(){},onElementOut:function(a){a.isHoverable()&&a.removeClass("hover"),this.currentClickDelay&&a.isTappable()&&this.stopTimer(),this.setElement(null)},setAttractor:function(a){this.attractor=a},hasAttractor:function(){return null!==this.attractor},capture:function(a){this.captureHost=a,this.setAttractor(null)},isCaptured:function(){return null!=this.captureHost},release:function(){this.captureHost=null},update:function(a,b,c){this.setPositionX(a),this.setPositionY(b),this.setPositionZ(c)},setPositionX:function(a){this.X=a-this.x,this.x=a},setPositionY:function(a){this.Y=a-this.y,this.y=a},setPositionZ:function(a){this.Z=a-this.z,this.z=a},getX:function(){return this.x},getY:function(){return this.y},getZ:function(){return this.z},setVelocityXYZ:function(a,b,c){this.setVelocityX(a),this.setVelocityY(b),this.setVelocityZ(c)},setVelocityX:function(a){this.vX=a},setVelocityY:function(a){this.vY=a},setVelocityZ:function(a){this.vZ=a},getVelocityX:function(){return this.vX},getVelocityY:function(){return this.vY},getVelocityZ:function(){return this.vZ},getEasing:function(){return this.easing},fireEvent:function(a){this.element&&this.element.fireEvent.apply(this.element,[a])},startTimer:function(){this.animiationIntervalID&&this.stopTimer(),this.startTime=new Date;var a=this;this.animiationIntervalID=setInterval(function(){a.onTapUpdate()},1e3/30),this.onTimerStart()},stopTimer:function(){clearInterval(this.animiationIntervalID),this.startTime=null,this.onTimerStop()},_onTapUpdate:function(){if(!this.startTime)return this.stopTimer(),void 0;var a=new Date,b=a-this.startTime;this.onTimerUpdate(b),b>=this.currentClickDelay&&(this.stopTimer(),this.onTimerComplete())},onTimerStart:function(){this.icon.setStyle({transitionDuration:this.currentClickDelay/1e3+"s"}),this.icon.addClass("active-timer")},onTimerStop:function(){this.icon.setStyle({transitionDuration:"0s"}),this.icon.removeClass("active-timer")},onTimerUpdate:function(){},onTimerComplete:function(){if(this.element){var a=document.createEvent("MouseEvent");a.initMouseEvent("mousedown",!0,!1,window,1,0,0,0,0,!1,!1,!1,!1,0,this.element),this.element.fireEvent(a),a=document.createEvent("MouseEvent"),a.initMouseEvent("mouseup",!0,!1,window,1,0,0,0,0,!1,!1,!1,!1,0,this.element),this.element.fireEvent(a),a=document.createEvent("MouseEvent"),a.initMouseEvent("click",!0,!1,window,1,0,0,0,0,!1,!1,!1,!1,0,this.element),this.element.fireEvent(a);var b=document.createEvent("UIEvent");if(b.initUIEvent("tap",!0,!1,window,1,0,0,0,0,!1,!1,!1,!1,0,this.element),this.element.fireEvent(b),this.multitapEnabled||this.element.hasMultitap()){var c=this;setTimeout(function(){c.startTimer()},100)}else this.release()}else this.release()}};return c.constructor(a),c},CursorManager=function(a){var b=".leap-interactive",c="leap-cursor-container",d="leap-cursor",e=[],f=null,g={},h=null,i={init:function(a){if(a.interactiveSelector&&(this.interactiveSelector=a.interactiveSelector),!f){f=new LeapElement(document.createElement("div"));var b=a.root||document.body;b.appendChild(f.element),f.addClass(c),f.setStyle({zIndex:1e5,position:"absolute",top:"0px",left:"0px"})}},add:function(a){-1===e.indexOf(a)&&(e.push(a),f.appendChild(a.icon),a.icon.addClass(d),a.onAdded())},remove:function(a){if(null!==g[a.source]&&null!==g[a.source][a.id]){var b=g[a.source][a.id];b.isAttractor()&&(a.setAttractor(null),b.hasCursor()&&b.release()),this.cursorOut(a,b,{x:0,y:0}),g[a.source][a.id]=null}var c=e.indexOf(a);-1!==c&&(f.removeChild(a.icon),e.splice(c,1),a.onRemoved())},update:function(){var a,b,c,d,f,h,i,j,k,l,m,n,o,p=.1,q=1;for(n=0;n<e.length;n++)o=e[n],g[o.source]||(g[o.source]={}),g[o.source][o.id]||(g[o.source][o.id]=null),a={x:Math.round(o.getX()*window.innerWidth),y:Math.round(o.getY()*window.innerHeight)},m=g[o.source][o.id],o.isEnabled()?(i=o.icon.getWidth()/2,j=o.icon.getHeight()/2,o.isCaptured()||(o.attractor?(k=o.attractor.element.getBoundingClientRect(),b={x:Math.round(k.left+k.width/2-i),y:Math.round(k.top+k.height/2-j)},c=b.x-o.icon.getX(),d=b.y-o.icon.getY(),f=Math.abs(c/(k.width/2)),h=Math.abs(d/(k.height/2)),f>1&&(f=1),h>1&&(h=1),f=Math.abs(1-f),h=Math.abs(1-h),o.setVelocityXYZ(c*Math.max(p,Math.min(q,f)),d*Math.max(p,Math.min(q,h)),0),Math.abs(o.getVelocityX())<=.1&&Math.abs(o.getVelocityY())<=.1&&(o.setVelocityXYZ(0,0,0),o.icon.setX(b.x),o.icon.setY(b.y),o.attractor.capture(o))):(c=a.x-i-o.icon.getX(),d=a.y-j-o.icon.getY(),o.setVelocityXYZ(c*o.getEasing(),d*o.getEasing()))),o.icon.setX(o.icon.getX()+o.getVelocityX()),o.icon.setY(o.icon.getY()+o.getVelocityY()),m=this.getCollidingElements(a),l=g[o.source][o.id],m&&(null==l&&(g[o.source][o.id]=m,m.isAttractor()&&!m.hasCursor()&&null==o.attractor&&null==o.captureHost&&o.setAttractor(m),this.cursorOver(o,m,a)),this.cursorMove(o,m,a)),l&&l!==m&&(l.isAttractor()&&(o.setAttractor(null),l.hasCursor()&&l.release(o)),this.cursorOut(o,l,a),g[o.source][o.id]=m,m&&(this.cursorOver(o,m,a),m.isAttractor()&&null==o.attractor&&null==o.captureHost&&(m.hasCursor()||o.setAttractor(m))))):m&&(m.isAttractor()&&(o.setAttractor(null),m.hasCursor()&&m.release()),this.cursorOut(o,m,a),g[o.source][o.id]=null)},cursorOver:function(a,b,c){h=document.createEvent("MouseEvent"),h.initMouseEvent("mouseover",!0,!1,window,1,c.x,c.y,c.x,c.y,!1,!1,!1,!1,0,b),b.fireEvent(h),a.onElementOver(b)},cursorMove:function(a,b,c){h=document.createEvent("MouseEvent"),h.initMouseEvent("mousemove",!0,!1,window,1,c.x,c.y,c.x,c.y,!1,!1,!1,!1,0,b),b.fireEvent(h),a.onElementMove(b)},cursorOut:function(a,b,c){h=document.createEvent("MouseEvent"),h.initMouseEvent("mouseout",!0,!1,window,1,c.x,c.y,c.x,c.y,!1,!1,!1,!1,0,b),b.fireEvent(h),a.onElementOut(b)},getCollidingElements:function(a){var c,d,e,f,g,h,i,j=document.querySelectorAll(b+", "+this.interactiveSelector)||[];for(e=0;e<j.length;e++)if(f=j[e],LeapManagerUtils.isElementVisible(f)&&(g=f.getBoundingClientRect(),f=LeapManagerUtils.getLeapElement(f),c=f.isAttractor()?f.getAttractorPadding().x:0,d=f.isAttractor()?f.getAttractorPadding().y:0,h=a.x>g.left-c&&a.x<g.left+g.width+c,i=a.y>g.top-d&&a.y<g.top+g.height+d,h&&i))return f;return null}};return i.init(a),i},MouseSimulator=function(){var a="leap-mouse-cursor";return{cursorManager:null,mouseCursor:null,init:function(b,c){this.cursorManager=b;var d=new LeapElement(document.createElement("div"));d.addClass(a);var e={source:"mouse",id:1,icon:d};LeapManagerUtils.extendIf(e,c),this.mouseCursor=new Cursor(e),this.enable()},enable:function(){this._onMouseMove=LeapManagerUtils.bind(this.onMouseMove,this),this._onMouseClick=LeapManagerUtils.bind(this.onMouseClick,this),document.addEventListener("mousemove",this._onMouseMove),document.addEventListener("click",this._onMouseClick),this.cursorManager.add(this.mouseCursor)},disable:function(){this.mouseCursor&&(document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("click",this._onMouseClick),this.cursorManager.remove(this.mouseCursor),this.mouseCursor=null)},update:function(a,b,c){this.mouseCursor.update(a,b,c)},onMouseMove:function(a){a=a||window.e;var b=0,c=0,d=0;a.pageX||a.pageY?(b=a.pageX,c=a.pageY):(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scollTop+document.documentElement.scrollTop),b/=window.innerWidth,c/=window.innerHeight,d=this.currentZ,this.update(b,c,d)},onMouseClick:function(){}}}(),LeapManager=function(){"use strict";var a="leap-pointable-cursor",b={maxCursors:1,simulateWithMouse:!1,enableInBackground:!1,root:null,gestureCallback:null,gestureScope:null,interactiveSelector:null,enableSenchaTouch:!1,boundary:{top:350,left:-100,right:100,bottom:150},cursorConfig:{multitapEnabled:!1,clickDelay:1e3},mouseCursorConfig:{multitapEnabled:!1,clickDelay:1e3},loopConfig:{enableGestures:!0}};return{cursorManager:null,cursors:[],init:function(a){LeapManagerUtils.extendIf(a,b),this.boundary=a.boundary,this.maxCursors=a.maxCursors,this.simulateWithMouse=a.simulateWithMouse,this.gestureCallback=a.gestureCallback,this.gestureScope=a.gestureScope,this.cursorConfig=a.cursorConfig,a.enableSenchaTouch&&(null==a.interactiveSelector?a.interactiveSelector="":a.interactiveSelector+=",",a.interactiveSelector+=["a",".x-tab",".x-button",".x-video-ghost"].join(",")),this.cursorManager=new CursorManager({root:a.root,interactiveSelector:a.interactiveSelector}),this.simulateWithMouse&&MouseSimulator.init(this.cursorManager,a.mouseCursorConfig||{});var c=this;c.isActiveWindow=!0,a.enableInBackground||(window.addEventListener("blur",function(){c.isActiveWindow=!1}),window.addEventListener("focus",function(){c.isActiveWindow=!0}));var d=function(a){c.onLoop(a)};null!==Leap&&Leap.loop(a.loopConfig,d)},onLoop:function(a){this.isActiveWindow&&(this.cursorManager.update(),this.updatePointables(a),this.updateGestures(a))},updatePointables:function(a){var b,c,d,e,f,g,h,i=[];if(a&&a.pointables)for(c=0;c<a.pointables.length&&c<this.maxCursors;c++)b=a.pointables[c],b&&(e=LeapManagerUtils.map(b.tipPosition[0],this.boundary.left,this.boundary.right,0,1),f=LeapManagerUtils.map(b.tipPosition[1],this.boundary.bottom,this.boundary.top,1,0),g=0,d=this.getCursor(b.id,{x:e,y:f,z:g}),i.push(d.id),d.update(e,f,g));var j={};for(h in this.cursors)d=this.cursors[h],-1===i.indexOf(d.id)?this.cursorManager.remove(d):j[d.id]=d;this.cursors=j},getCursor:function(b,c){if(this.cursors[b])return this.cursors[b];var d=new LeapElement(document.createElement("div"));d.addClass(a);var e={source:"leap",id:b,position:c,icon:d};LeapManagerUtils.extend(e,this.cursorConfig);var f=this.cursors[b]=new Cursor(e);return this.cursorManager.add(f),f},updateGestures:function(a){var b,c=this;a.gestures.length>0&&a.gestures.forEach(function(a){a.pointableIds&&a.pointableIds.length>0&&a.pointableIds.forEach(function(d){if(c.cursors&&c.cursors[d]&&(b=c.cursors[d])){if(b.hasElement()){var e=document.createEvent("Event");e.initEvent("leap-"+a.type,!0,!0),e.state=a.state,e.gesture=a,b.element.fireEvent(e),e=document.createEvent("Event"),e.initEvent("leap-"+a.type+"-"+a.state,!0,!0),e.state=a.state,e.gesture=a,b.element.fireEvent(e)}c.gestureCallback&&c.gestureCallback.call(c.gestureScope||c,a)}})})}}}();